{"path":"api-docs/storefront/customer-login-api","templateID":0,"sharedPropsHashes":{"nav":"Z2k7O5R","sidebarTree":"Z1Jm3fi","namespace":"Zd6xn0"},"localProps":{"version":"1.3","crumbs":[{"content":"API Docs","to":"/api-docs"},{"content":"Storefront APIs","to":"/api-docs/storefront"},{"content":"Customer Login API","to":"/api-docs/storefront/customer-login-api"}],"page":{"meta":{"title":"Customer Login API - Storefront APIs - API Docs","url":"/api-docs/storefront/customer-login-api","description":"Customer Login API\n\n\n\nOn this page\n\nIntroduction\n\nOverview\n\nPrerequisites\n\nEnable single sign-on\n\nTroubleshooting\n\nRelated resources\n\n\n\nIntroduction\n\nIn..."},"title":"Customer Login API","parsedPath":["pages","/api-docs","data","children",1,"data","children",4],"rootPagePath":"/api-docs","path":"/api-docs/storefront/customer-login-api","isSubpage":true,"route":{"path":"/customer-login-api"},"data":{"blocks":[{"type":"text","data":"# Customer Login API\n\n<div class=\"otp\" id=\"no-index\">\n\n### On this page\n- [Introduction](#introduction)\n- [Overview](#overview)\n- [Prerequisites](#prerequisites)\n- [Enable single sign-on](#enable-single-sign-on)\n- [Troubleshooting](#troubleshooting)\n- [Related resources](#related-resourcess)\n\n</div> \n\n## Introduction\nIn this tutorial, you will learn how to enable single sign-on for storefront customers using the Customer Login API and JSON Web Tokens.\n\n## Overview\n\nSingle sign-on (SSO) is an authentication mechanism that enables users to log into multiple software applications using the same set of credentials that the user enters only once. It eliminates the need to maintain multiple passwords, which streamlines the process of accessing web applications. For more details, see [Single Sign-On](https://en.wikipedia.org/wiki/Single_sign-on). \n\nWhen a user logs into your web app, you can use the Customer Login API to authenticate the user to your BigCommerce store through SSO.\n\nYou can use the Customer Login API in the following use cases:\n\n* Integrate with an SSO provider or identity provider (IdP) \n* Set up continuous login between a BigCommerce store and another application\n* Enable alternative login methods (ex. phone number and SMS password)\n\nStorefront customers are logged in using the access point URL `/login/token/{token}`. The `{token}` must be a JSON Web Token (JWT) containing parameters for the customer login request signed by your application’s OAuth client secret. For more information on the OAuth protocol, see [OAuth](https://oauth.net/2/). \n\nJWT is an industry standard ([RFC 7519](https://tools.ietf.org/html/rfc7519)) for securely transmitting information between two parties. A JWT is represented as a sequence of base64url-encoded sections separated by dots (` . `).  The sections include the header, payload, and signature. For more details, see [Introduction to JSON Web Tokens](https://jwt.io/introduction/). \n\n**Payload fields reference**\n\n| Field Name | Type | Description |\n|-|-|-|\n| `iss` | string | Indicates the token's issuer. This is your application's Client ID.|\n| `iat` | integer| Time when the token was generated. This is a numeric value indicating the number of seconds since the [Unix epoch](http://en.wikipedia.org/wiki/Unix_time).|\n| `jti` | string | A unique request ID (ex. uuid).|\n| `operation` | string | Must contain the string `\"customer_login\"`.|\n| `store_hash` | string | Store hash identifying the store you are logging into.|\n| `customer_id` | integer | ID of the customer you are logging in.|\n| `redirect_to` | string | Optional field containing a relative path for the shopper's destination after login. Will default to `/account.php`. |\n| `request_ip` | string | Optional field containing the expected IP address for the request. If provided, BigCommerce will check that it matches the browser trying to log in.|\n\n## Prerequisites\n\nTo enable SSO using the Customer Login API, you will need the following: \n\n* A BigCommerce store\n* API client ID and client secret with the OAuth Scope set to Customers Login\n* [Node.js](https://nodejs.org/en/) installed on your machine if you plan to use JavaScript\n\nIf you do not know your client ID and client secret, obtain the credentials by following the steps outlined in [Creating an API Account](https://support.bigcommerce.com/articles/Public/Store-API-Accounts/#creating). \n\nBe sure to set the Customers Login scope to Login. \n\n![Example OAuth Scope](https://storage.googleapis.com/bigcommerce-production-dev-center/images/scopes.png \"Example OAuth Scope\")\n\n## Enable single sign-on\n\nTo log a customer into their storefront account using the Customer Login API, your app needs to redirect the customer’s browser to the following access point URL: `https://storedomain.com/login/token/{token}`.\n\nThe `{token}` parameter is the JWT containing the payload data signed by your app’s OAuth client secret.\n\nWe recommend writing a script to generate a login token since JTW’s `iat` (issued at) claim is only valid for 30 seconds. BigCommerce supplies helper methods for generating login tokens in our [API Client Libraries](https://developer.bigcommerce.com/tools-resources).\n\nThe beginning of this tutorial focuses on manually creating a token using the debugger tool at [JWT.io](https://jwt.io/). Then, we will explore how to use a JavaScript function to programmatically generate an access point URL. \n\n### Create JWT using the debugger tool\n\nTo create a JWT, you will need to obtain a `customer_id` using the [Customers v3 API](https://developer.bigcommerce.com/api-reference/store-management/customers-v3). \n\n1. Send a `GET` request to the [Get All Customers](https://developer.bigcommerce.com/api-reference/store-management/customers-v3/customers/customersget) endpoint. Choose a customer and make note of the `customer_id`. \n\n```json\n{\n    \"accepts_product_review_abandoned_cart_emails\": true,\n    \"authentication\": {\n      \"force_password_reset\": false\n    },\n    \"company\": \"BigCommerce\",\n    \"customer_group_id\": 2,\n    \"date_created\": \"2020-02-06T17:46:33Z\",\n    \"date_modified\": \"2020-02-07T19:58:03Z\",\n    \"email\": \"customer@email.com\",\n    \"first_name\": \"Jane\",\n    \"id\": 1,    #customer_id\n    \"last_name\": \"Doe\",\n    \"notes\": \"\",\n    \"phone\": \"\",\n    \"registration_ip_address\": \"\",\n    \"tax_exempt_category\": \"D\"\n}\n```\n\n2. Open the debugger at [JWT.io](https://jwt.io/). \n\n3. In the \"HEADER\" field, make sure the JWT `alg` (algorithm) field is set to `\"HS256\"` and the `typ` (token type) field is set to `\"JWT\"`.\n\n![JWT Header](https://storage.googleapis.com/bigcommerce-production-dev-center/images/header-token.png \"Header\")\n\n4. In the \"PAYLOAD: DATA\" field, create a payload. \n\n![JWT Payload](https://storage.googleapis.com/bigcommerce-production-dev-center/images/payload-data.png \"Payload\")\n\n5. In the \"VERIFY SIGNATURE\" field, replace “your-256-bit-secret” with your Client Secret. \n\n![JWT Signature](https://storage.googleapis.com/bigcommerce-production-dev-center/images/verify-signature.png \"Signature\")\n\n6. Copy the login token from the encoded box and paste it into the access point URL replacing the `{token}` parameter. \n</br>\nExample:\n\n```http\nhttps://storedomain.com/login/token/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ7Y2xpZW50X2lkfSIsImlhdCI6MTUzNTM5MzExMywianRpIjoie3V1aWR9Iiwib3BlcmF0aW9uIjoiY3VzdG9tZXJfbG9naW4iLCJzdG9yZV9oYXNoIjoie3N0b3JlX2hhc2h9IiwiY3VzdG9tZXJfaWQiOjJ9.J-fAtbjRFGdLsT744DhoprFEDqIfVq72HbDzrbFy6Is\n```\n\n7. Paste the URL into the address bar of your web browser. \n\nIf the request was successful, you will be logged in as a customer and directed to `/account.php`. If it was unsuccessful, a login attempt error message will be displayed and you will be directed to `/login.php`. \n\n![Login Error](https://storage.googleapis.com/bigcommerce-production-dev-center/images/invalid-login.png \"Login Error\")\n\nFor common causes of login failure, see [Troubleshooting](#troubleshooting).\n\n### Create JWT using a JavaScript function\n\nIn this part of the tutorial, we will walk you through creating an access point URL using JavaScript. You will need [node.js](https://nodejs.org/en/) installed on your machine to complete this section. \n\n1. Create and open a new folder by running the following commands in your terminal:\n</br>\n\n```bash\n$ mkdir urlGenerator\n$ cd urlGenerator\n```\n\n2. Create a new node project with the following command:\n</br>\n\n```bash\n$ npm init\n```\n\n3. Install [jsonwebtoken](https://www.npmjs.com/package/jsonwebtoken) and [uuid](https://www.npmjs.com/package/uuid) npm packages:\n</br>\n\n```bash\n$ npm install jsonwebtoken uuid\n```\n\n4. Open the `urlGenerator` folder in your code editor of choice and create a new JS file.\n\n5. Paste the following code into the new JS file:\n\n```js\nconst jwt = require('jsonwebtoken');\nconst {v4: uuidv4} = require('uuid');\n \nfunction getLoginUrl(customerId, storeHash, storeUrl, clientId, clientSecret) {\n   const dateCreated = Math. round((new Date()). getTime() / 1000);\n   const  payload = {\n       \"iss\": clientId,\n       \"iat\": dateCreated,\n       \"jti\": uuidv4(),\n       \"operation\": \"customer_login\",\n       \"store_hash\": storeHash,\n       \"customer_id\": customerId,\n   }\n   let token = jwt.sign(payload, clientSecret, {algorithm:'HS256'});\n   return `${storeUrl}/login/token/${token}`;\n};\n \nconst clientId = \"Your client id\";\nconst clientSecret = \"Your client secret\";\nconst customerId = \"Your customer id\";\nconst storeHash = \"Your store hash\";\nconst storeUrl = \"Your store url\";\n \nconst loginUrl = getLoginUrl(customerId, storeHash, storeUrl, clientId, clientSecret);\nconsole.log(loginUrl);\n```\n6. Replace your app and customer-specific values in the variables.\n\n7. Run the code: \n</br>\n  \n```bash\n$ node youFileName.js\n```\nYou should receive a complete access point URL as an output. \n\n8. Copy the URL and paste it into the address bar of your browser. \n\nIf the request was successful, you will be logged in as a customer and directed to `/account.php`. If it was unsuccessful, you will receive a login attempt error message and be directed to `/login.php`. For common causes of login failure, see [Troubleshooting](#troubleshooting).\n\n### Sample code\n\nHelper methods for generating login tokens are provided in our [API Client Libraries](https://developer.bigcommerce.com/tools-resources). See the following BigCommerce repositories for language-specific examples:\n\n* [PHP sample](https://github.com/bigcommerce/bigcommerce-api-php/blob/master/src/Bigcommerce/Api/Client.php#L421)\n* [Python sample](https://github.com/bigcommerce/bigcommerce-api-python/blob/master/bigcommerce/customer_login_token.py)\n* [Ruby sample](https://github.com/jordanarldt/ruby-bc-customer-sso-generator/)\n\nFor client libraries in other languages, see [Libraries for Token Signing/Verification](https://jwt.io/#libraries-io).\n\n### Logging out \n\nTo log out a customer, set the `redirect_to` field of the JWT’s payload to `/login.php?action=logout`. \n\n## Troubleshooting\n\n* If the clock of the server generating the “iat” claim is not synchronized, the timestamp will be out of sync and the request will fail. If your system’s time is different from the BigCommerce server time, you can use the [Get System Timestamp](https://developer.bigcommerce.com/api-reference/store-management/store-information-api/time-zone/gettime) endpoint as a source of truth.\n* You can only visit the access point URL once. The token will be invalidated after the `GET` request is made.\n* Tokens should not be generated in advance. Instead, the app should generate the token and immediately redirect the user’s browser to the access point URL. \n\n## Related resources \n\n### Articles\n* [Authenticating BigCommerce’s REST APIs](https://developer.bigcommerce.com/api-docs/getting-started/authentication/rest-api-authentication#obtaining-store-api-credentials#obtaining-store-api-credentials)\n* [BigCommerce APIs Quick Start](https://developer.bigcommerce.com/api-docs/getting-started/making-requests)\n* [Store API Accounts](https://support.bigcommerce.com/articles/Public/Store-API-Accounts/)\n* [Introduction to JSON Web Tokens](https://jwt.io/introduction/)\n\n### Endpoints\n* [Customer Login SSO](https://developer.bigcommerce.com/api-reference/storefront/customer-login-sso)\n* [Customers V3](https://developer.bigcommerce.com/api-reference/store-management/customers-v3)\n"}],"children":[]}}}}
