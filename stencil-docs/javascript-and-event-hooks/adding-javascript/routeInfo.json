{"path":"stencil-docs/javascript-and-event-hooks/adding-javascript","templateID":0,"sharedPropsHashes":{"nav":"Z2k7O5R","sidebarTree":"23J4Lj","namespace":"Zd6xn0"},"localProps":{"version":"1.3","crumbs":[{"content":"Stencil Docs","to":"/stencil-docs"},{"content":"JavaScript","to":"/stencil-docs/javascript-and-event-hooks"},{"content":"Adding Javascript","to":"/stencil-docs/javascript-and-event-hooks/adding-javascript"}],"page":{"meta":{"title":"Adding Javascript - JavaScript - Stencil Docs","url":"/stencil-docs/javascript-and-event-hooks/adding-javascript","description":"Adding Javascript to Your Stencil Theme\n\n\n\nOn this page\n\nBundling and minification\n\nDevelopment options\n\nUsing npm\n\nPage types and Javascript API\n\nJavaS..."},"title":"Adding Javascript","parsedPath":["pages","/stencil-docs","data","children",5,"data","children",0],"rootPagePath":"/stencil-docs","path":"/stencil-docs/javascript-and-event-hooks/adding-javascript","isSubpage":true,"route":{"path":"/adding-javascript"},"data":{"blocks":[{"type":"text","data":"# Adding Javascript to Your Stencil Theme\n\n<div class=\"otp\" id=\"no-index\">\n\n### On this page\n\n- [Bundling and minification](#bundling-and-minification)\n- [Development options](#development-options)\n- [Using npm](#using-npm)\n- [Page types and Javascript API](#page-types-and-javascript-api)\n- [JavaScript template context injection](#javascript-template-context-injection)\n- [Placing modules in assets/js/](#placing-modules-in-assetsjs)\n- [Theme-specific JavaScript modules](#theme-specific-javascript-modules)\n- [Mapping page types to JavaScript modules](#mapping-page-types-to-javascript-modules)\n- [Mapping custom templates to JavaScript modules](#mapping-custom-templates-to-javascript-modules)\n- [Summary](#summary)\n\n</div>\n\n## Bundling and minification\n\nA small web application, such as a theme, can include rich user interactions that depend on many small JavaScript and CSS modules. If we were to embed each of the JavaScript modules in a template file with a separate `<script>` tag, the shopper's browser would need to make separate HTTP requests to retrieve each module.\n\nIn some cases, it would take longer to set up the HTTP request than to download the small JavaScript module, leading to slower load times. On mobile devices, slow load times can be especially frustrating.\n\n### Bundling\n\nTo solve this problem, Stencil, like other modern front-end frameworks, bundles all the JavaScript modules into a single file (a bundle), allowing the shopper's browser to make only a single HTTP request. After the browser has downloaded the bundle of JavaScript modules, the browser caches them, speeding up the rest of the shopper's session.\n\n### Minification\n\nBeyond reducing the number of HTTP calls required to fetch all the required JavaScript modules, we can reduce the size of the individual JavaScript modules through minification. JavaScript minification removes white space and comments, shortens variable and function names, removes dead code, and more. The goal, in all cases, is to reduce the amount of bandwidth necessary to transmit the JavaScript module to the browser.\n\n## Development options\n\nWhen you add JavaScript to a theme, use one of the following techniques, so that Stencil will automatically bundle and minify your modules.\n\n* **Using npm:** Add third-party JavaScript modules to your theme with npm where possible.\n* **Place modules in assets/js/:** For a JavaScript module that is not distributed via npm, add this module to your theme by creating a subdirectory within assets/js/ that contains your module.\n* **Theme-specific JavaScript modules:** Stencil themes include their own custom JavaScript modules for most page types. You can alter these page-type–specific modules by editing the files in assets/js/theme/*.js.\n\nThese techniques are outlined in the following sections.\n\n## Using npm\n\nMany third-party JavaScript components are distributed with npm. When you use the npm command-line utility to add a JavaScript component to your theme, Stencil will automatically bundle and minify the component. To enable this bundling and minification, run each module's `npm install` command from the root directory of your theme.\n\n### Taking over from npm\n\nThe npm package manager facilitates the management of third-party JavaScript components by placing each JavaScript component in the correct directories. However, as a developer, you will still need to edit your theme files to wire up the JavaScript component to expose it on your storefront. You will find several examples of this on the following pages.\n\n## Page types and Javascript API\n\nStencil themes include an API for running JavaScript on a per-page basis. To properly write JavaScript for your theme, you will have the following page types available to you:\n\n* `pages/account/addresses`\n* `pages/account/add-address`\n* `pages/account/add-return`\n* `pages/account/add-wishlist`\n* `pages/account/recent-items`\n* `pages/account/download-item`\n* `pages/account/edit`\n* `pages/account/return-saved`\n* `pages/account/returns`\n* `pages/auth/login`\n* `pages/auth/account-created`\n* `pages/auth/create-account`\n* `pages/auth/new-password`\n* `pages/blog`\n* `pages/blog-post`\n* `pages/brand`\n* `pages/brands`\n* `pages/cart`\n* `pages/category`\n* `pages/compare`\n* `pages/errors`\n* `pages/gift-certificate/purchase`\n* `pages/gift-certificate/balance`\n* `pages/gift-certificate/redeem`\n* `global`\n* `pages/home`\n* `pages/order-complete`\n* `pages/page`\n* `pages/product`\n* `pages/search`\n* `pages/sitemap`\n* `pages/subscribed`\n* `pages/account/wishlist-details`\n* `pages/account/wishlists`\n* `pages/order-confirmation`\n* `pages/checkout`\n\nThese page types correspond to the pages within your theme. Each of these page types maps to an ES6 module that extends the base `PageManager` abstract class\n\n```js\nexport default class Blog extends PageManager {\n        constructor() {\n            //Setup code goes here – attach to internals, and use internals as you would 'this'\n        }\n    }\n```\n\n<div class=\"HubBlock--callout\">\n<div class=\"CalloutBlock--info\">\n<div class=\"HubBlock-content\">\n\n> ### Note\n> * Page types correspond to the HTML pages in [templates/pages/](https://github.com/bigcommerce/cornerstone/tree/master/templates/pages).\n\n</div>\n</div>\n</div>\n\n## JavaScript template context injection\n\nOccasionally, you might need to use dynamic data from the template context within your theme's client-side application code. Two helpers are provided to help achieve this.\n\nThe `inject` helper allows you to compose a JSON object with a subset of the template context to be sent to the browser:\n\n`{{inject \"stringBasedKey\" contextValue}}`\n\nTo retrieve the parsable JSON object, call `{{jsContext}}` after all of the `{{inject}}` calls.\n\nFor example, to set up the product name in your client-side app, you can do this if you're in the context of a product:\n\n```html\n{{inject \"myProductName\" product.title}}\n\n<script>\n// Note the lack of quotes around the jsContext handlebars helper, it becomes a string automatically.\nvar jsContext = JSON.parse({{jsContext}}); //jsContext would output \"{\\\"myProductName\\\": \\\"Sample Product\\\"}\" which can feed directly into your JavaScript\n\nconsole.log(jsContext.myProductName); // Will output: Sample Product\n</script>\n```\n\nYou can compose your JSON object across multiple pages, to create a different set of client-side data depending on the currently loaded template context.\n\nStencil's Cornerstone base theme makes the `jsContext` available as `this.context`, both on the active page scoped and on global `PageManager` objects.\n\n## Placing modules in assets/js/\n\nYou can freely create subdirectories within `assets/js/`, to contain new JavaScript modules. The constraint is that all JavaScript files in each module must use the `.js` file extension.\n\n## Theme-specific JavaScript modules\n\nIn your theme's `assets/js/theme/` subdirectory, you will find a tree of JavaScript files. Each file is a JavaScript module. Some modules are for specific page types. Others are common modules that can be used in other modules. Still others are global modules that are available on every page.\n\n## Mapping page types to JavaScript modules\n\nTo find the mapping from page types to modules in `assets/js/theme/`, examine the `pageClasses` object in the file: `assets/js/app.js`.\n\nEach `=>import(...)` function within this class maps a page type to the entry module for that page type. For example, when the `cart` page type is loaded in the browser, the JavaScript module named `cart` will be loaded.\n\n### Mapping example in app.js\n\nBelow is an excerpt of mappings from the Cornerstone base theme's [assets/js/app.js](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/app.js).\n\n```javascript\nimport Global from './theme/global';\n\nconst getAccount = () => import('./theme/account');\nconst getLogin = () => import('./theme/auth');\nconst noop = null;\n\nconst pageClasses = {\n    account_orderstatus: getAccount,\n    account_order: getAccount,\n    account_addressbook: getAccount,\n    shippingaddressform: getAccount,\n    account_new_return: getAccount,\n    'add-wishlist': () => import('./theme/wishlist'),\n    account_recentitems: getAccount,\n    account_downloaditem: getAccount,\n    editaccount: getAccount,\n    account_inbox: getAccount,\n    account_saved_return: getAccount,\n    account_returns: getAccount,\n    account_paymentmethods: getAccount,\n    account_addpaymentmethod: getAccount,\n    account_editpaymentmethod: getAccount,\n    login: getLogin,\n    createaccount_thanks: getLogin,\n    createaccount: getLogin,\n    getnewpassword: getLogin,\n    forgotpassword: getLogin,\n    blog: noop,\n    blog_post: noop,\n    brand: () => import('./theme/brand'),\n    brands: noop,\n    cart: () => import('./theme/cart'),\n    category: () => import('./theme/category'),\n    compare: () => import('./theme/compare'),\n    page_contact_form: () => import('./theme/contact-us'),\n    error: noop,\n    404: noop,\n    giftcertificates: () => import('./theme/gift-certificate'),\n    giftcertificates_balance: () => import('./theme/gift-certificate'),\n    giftcertificates_redeem: () => import('./theme/gift-certificate'),\n    default: noop,\n    page: noop,\n    product: () => import('./theme/product'),\n    amp_product_options: () => import('./theme/product'),\n    search: () => import('./theme/search'),\n    rss: noop,\n    sitemap: noop,\n    newsletter_subscribe: noop,\n    wishlist: () => import('./theme/wishlist'),\n    wishlists: () => import('./theme/wishlist'),\n};\n```\n\n### Mapping example in cart.js\n\nInside the `cart` module ([assets/js/theme/cart.js](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart.js)), other modules are imported, and custom JavaScript methods for the cart module are created for the `Cart` class.\n\nBelow is an excerpt from Cornerstone's `assets/js/theme/cart.js` file.\n\n```javascript\nimport PageManager from './page-manager';\nimport _ from 'lodash';\nimport giftCertCheck from './common/gift-certificate-validator';\nimport utils from '@bigcommerce/stencil-utils';\nimport ShippingEstimator from './cart/shipping-estimator';\nimport { defaultModal } from './global/modal';\nimport swal from './global/sweet-alert';\n\nexport default class Cart extends PageManager {\n    onReady() {\n        this.$cartContent = $('[data-cart-content]');\n        this.$cartMessages = $('[data-cart-status]');\n        this.$cartTotals = $('[data-cart-totals]');\n        this.$overlay = $('[data-cart] .loadingOverlay')\n            .hide(); // TODO: temporary until roper pulls in his cart components\n\n        this.bindEvents();\n    }\n\n\t\tcartUpdate($target) {\n        const itemId = $target.data('cartItemid');\n        const $el = $(`#qty-${itemId}`);\n        const oldQty = parseInt($el.val(), 10);\n        const maxQty = parseInt($el.data('quantityMax'), 10);\n        const minQty = parseInt($el.data('quantityMin'), 10);\n        const minError = $el.data('quantityMinError');\n        const maxError = $el.data('quantityMaxError');\n        const newQty = $target.data('action') === 'inc' ? oldQty + 1 : oldQty - 1;\n        // Does not quality for min/max quantity\n        if (newQty < minQty) {\n            return swal({\n                text: minError,\n                type: 'error',\n            });\n        } else if (maxQty > 0 && newQty > maxQty) {\n            return swal({\n                text: maxError,\n                type: 'error',\n            });\n        }\n```\n\n## Mapping custom templates to JavaScript modules\n\nIf you add [custom page templates](/stencil-docs/storefront-customization/custom-templates/) to your theme, you can edit the same `assets/js/app.js` file to map each custom template to an appropriate JavaScript module.\n\nIn the following example, we will map a custom JavaScript file, `assets/js/themes/custom.js` to a custom product page file `templates/pages/custom/product/customProd.html`.\n\n```js\nimport PageManager from \"./page-manager\";\n\nexport default class Custom extends PageManager {\n    onReady(){\n        alert(\"Hello world!\");\n    }\n}\n```\n\nThis is a basic module that creates a class called `Custom` which extends the PageManager class.\n\n```html\n{{~inject 'template' template}}\n<h2>Hello World!</h2>\n<body>\nSome custom content!\n<body>\n<script>window.__webpack_public_path__ = \"{{cdn 'assets/dist/'}}\";</script>\n<script src=\"{{cdn 'assets/dist/theme-bundle.main.js'}}\"></script>\n<script>window.stencilBootstrap(\"{{page_type}}\", {{jsContext}}).load();</script>\n```\n\nIn order to successully map your custom module to a custom template file, that file must do the following:\n* Inject the custom template\n* Load webpack\n* Load the main theme bundle\n* Load stencilBootstrap\n\nIt is a good idea to pull in `{{>layout/base}}` to your custom template file because of these requirements.\n\nFinally, use the customClasses function in `assets/js/app.js` to map the custom page file to your custom template. Your app.js file should look like this:\n\n```js\nconst customClasses = {\n    'pages/custom/product/customProd': () => import('./theme/custom'), // Mac/Linux\n    'pages\\\\custom\\\\product\\\\customProd': () => import('./theme/custom'), // Windows\n};\n/**\n * This function gets added to the global window and then called\n * on page load with the current template loaded and JS Context passed in\n * @param pageType String\n * @param contextJSON\n * @returns {*}\n */\nwindow.stencilBootstrap = function stencilBootstrap(pageType, contextJSON = null, loadGlobal = true) {\n    const context = JSON.parse(contextJSON || '{}');\n\n    return {\n        load() {\n            $(() => {\n                // Load globals\n                if (loadGlobal) {\n                    Global.load(context);\n                }\n\n                const importPromises = [];\n\n                // Find the appropriate page loader based on pageType\n                const pageClassImporter = pageClasses[pageType];\n                if (typeof pageClassImporter === 'function') {\n                    importPromises.push(pageClassImporter());\n                }\n\n                // See if there is a page class default for a custom template\n                const customTemplateImporter = customClasses[context.template];\n                if (typeof customTemplateImporter === 'function') {\n                    importPromises.push(customTemplateImporter());\n                }\n\n                // Wait for imports to resolve, then call load() on them\n                Promise.all(importPromises).then(imports => {\n                    imports.forEach(imported => {\n                        imported.default.load(context);\n                    });\n                });\n            });\n        },\n    };\n};\n```\n\n## Summary\n\nTo review the basics of using JavaScript in your Stencil theme:\n\n* Stencil automatically bundles and minifies JavaScript modules to optimize page performance.\n* To insert custom JavaScript on a particular page in your theme, edit the JavaScript module that corresponds to the page's type.\n* To add files from third-party JavaScript modules to a theme, use npm where possible.\n* To add JavaScript modules not distributed via npm, you can create new subdirectories within [assets/js/](https://github.com/bigcommerce/cornerstone/tree/master/assets/js).\n* Theme-Specific JavaScript modules are provided in the theme's [assets/js/theme/](https://github.com/bigcommerce/cornerstone/tree/master/assets/js/theme) subdirectory.\n* To find the mapping between modules in assets/js/theme/ and page types, examine the PageClasses object contained in [assets/js/app.js](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/app.js).\n* You can map JavaScript modules to custom page templates by editing the [assets/js/app.js](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/app.js) file.\n"}],"children":[]}}}}
