{"path":"stencil-docs/reference-docs/stencil-utils-api-reference","templateID":0,"sharedPropsHashes":{"nav":"Z2k7O5R","sidebarTree":"23J4Lj","namespace":"Zd6xn0"},"localProps":{"version":"1.3","crumbs":[{"content":"Stencil Docs","to":"/stencil-docs"},{"content":"Reference Docs","to":"/stencil-docs/reference-docs"},{"content":"stencil-utils","to":"/stencil-docs/reference-docs/stencil-utils-api-reference"}],"page":{"meta":{"title":"stencil-utils - Reference Docs - Stencil Docs","url":"/stencil-docs/reference-docs/stencil-utils-api-reference","description":"Stencil Utils Reference\n\n\n\nOn this Page\n\nInstalling\n\napi.js\n\nCart API\n\nCountries Resource\n\nProduct Attributes Resource\n\nProduct Resource\n\nSearch Resourc..."},"title":"stencil-utils","parsedPath":["pages","/stencil-docs","data","children",10,"data","children",3],"rootPagePath":"/stencil-docs","path":"/stencil-docs/reference-docs/stencil-utils-api-reference","isSubpage":true,"route":{"path":"/stencil-utils-api-reference"},"data":{"blocks":[{"type":"text","data":"# Stencil Utils Reference\n\n<div class=\"otp\" id=\"no-index\">\n\n###  On this Page\n- [Installing](#installing)\n- [api.js](#apijs)\n- [Cart API](#cart-api)\n- [Countries Resource](#countries-resource)\n- [Product Attributes Resource](#product-attributes-resource)\n- [Product Resource](#product-resource)\n- [Search Resource](#search-resource)\n- [Config Object](#config-object)\n- [Resources](#resources)\n</div>\n\n[Stencil Utils](https://github.com/bigcommerce/stencil-utils) is a utility library that contains the BigCommerce Stencil Events system and other functions that make building a theme with the Stencil framework a breeze.\n\nThese functions help you set up asynchronous requests to modify the customer’s cart or storefront view. By using this abstraction library, you can gain more-granular control over themes’ presentation. Use stencil-utils to:\n- Interact with the cart\n- Use `getPage` to return a template file.\n\n## Installing\n\n### As an ES6 module\n1. Run  `npm install @bigcommerce/stencil-utils`  to install the latest tagged version of stencil-utils for use with your theme.\n2. Import the library  `import utils from 'bigcommerce/stencil-utils';`  in modules that depend on it.\n\n### Standalone\n\nIf you do not want to support ES6 modules, Stencil Utils can be included as a normal script:\n-   Copy the bundled script from  `dist/stencil-utils.min.js`  to your theme.\n-   Include the script in your HTML document\n-   Access stencil utils from  `window.stencilUtils`\n\n## api.js\n\n### [getPage ](https://github.com/bigcommerce/stencil-utils/blob/master/src/api.js) \nRequest a page using [Ajax](https://developer.mozilla.org/en-US/docs/Web/Guide/AJAX).  \n`utils.api.getPage(url, options, callback)`\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>url</td>\n    <td>String</td>\n    <td>request URL (ex: `/cart.php`)</td>\n  </tr>\n  <tr>\n    <td>options</td>\n    <td>Object</td>\n\t\t<td>Can contain <code>template</code>, <code><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FormData\">FormData</a></code> (for POST methods), <code>params</code>&nbsp;(for GET methods), and/or <code>config</code>.   \n\t\tThe <code>template</code> option allows you to select a particular template, or an array of templates, for rendering one page. Each value must correspond to a file present in the theme's <code>templates/components/</code> subdirectory. \n      The `config` option can be used to pass extra resources, corresponding to attributes that are valid in a page's front matter, as an object.\n    </td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n</table>\n\nThe <code>config</code> argument works like front matter: it encapsulates JSON. For a usage example of <code>config</code>, see the [Remote API Example](/stencil-docs/adding-event-hooks-to-your-theme/remote-api-example#remote_remote-api-example).\n\n**getPage Example**\n\nIn the following example (from `common/faceted-search.js`), `api.getPage()` is called to help execute an `updateView()` function:\n\n```js\nupdateView() {\n        $(this.options.blockerSelector).show();\n\n        api.getPage(urlUtils.getUrl(), this.requestOptions, (err, content) => {\n            $(this.options.blockerSelector).hide();\n\n            if (err) {\n                throw new Error(err);\n            }\n\n            // Refresh view with new content\n            this.refreshView(content);\n        });\n    }\n ```\n\n### Usage in Cornerstone\n- [`assets/js/theme/wishlist.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/wishlist.js)\n- [`assets/js/theme/gift-certificate.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/gift-certificate.js)\n- [`assets/js/theme/faceted-search.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/common/faceted-search.js)\n\n## Cart API \n\nThe following functions allow your theme to work with [cart](https://github.com/bigcommerce/stencil-utils/blob/9cf7c26b0a1f9ca9da83274ebc375e73f20acac5/src/api/cart.js) contents in customized ways.\n\n### [getCart](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L11)\n\n| Argument | Type | Description |\n| -- | -- | -- |\n| options | object | Return product variant options |\n| callback | Function | Asynchronous function call to handle the results |\n\n**getCart Example**\n\n`utils.api.cart.getCart()`\n\n```js\nutils.api.cart.getCart({}, (err, response) => {\n    console.log(response);\n    console.log(err);\n});\n\nutils.api.cart.getCart({includeOptions: true}, (err, response) => {\n    console.log(response);\n    console.log(err);\n});\n```\n\n### [getCartQuantity](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L28) \n\nGet a sum of the cart line item quantities. \n\n`utils.api.cart.getCartQuantity()`\n\n| Argument | Type | Description |\n| -- | -- | -- |\n| options | object | Return product variant options |\n| callback | Function | Asynchronous function call to handle the results |\n\n**getCartQuantity Example**\n\n```js\nutils.api.cart.getCartQuantity({}, (err, response) => {\n    console.log(response);\n    console.log(err);\n});\n\nutils.api.cart.getCartQuantity({}, (err, response) => {\n    console.log(response);\n    console.log(err);\n});\n```\n\n### Usage in Cornerstone\n- [`assets/js/theme/global/cart-preview.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/global/cart-preview.js)\n\n### [itemAdd](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L51)\n\nThe `itemAdd`function allows your code to add an item to the cart, with options:\n\n<code>utils.api.cart.itemAdd(<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FormData\">FormData</a>, callback)</code>\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>FormData</td>\n    <td><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FormData\">FormData</a> object </td>\n    <td>Contains all details about the added item and its product options.<br /> FormData example:\n\t    \n```html\naction: add\nproduct_id: 123\nattribute[123]: 321\nqty[]: 1\n```\n</td>\t    \n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n</table>\n\n**itemAdd Example**\n\n<code>itemAdd</code> is called at the head of the following example (from <code>common/product-details.js</code>) to populate the cart:\n\n```js\n\n        utils.api.cart.itemAdd(this.filterEmptyFilesFromForm(new FormData(form)), (err, response) => {\n            const errorMessage = err || response.data.error;\n\n            $addToCartBtn\n                .val(originalBtnVal)\n                .prop('disabled', false);\n\n            this.$overlay.hide();\n\n            // Guard statement\n            if (errorMessage) {\n                // Strip the HTML from the error message\n                const tmp = document.createElement('DIV');\n                tmp.innerHTML = errorMessage;\n\n                return showAlertModal(tmp.textContent || tmp.innerText);\n            }\n\n            // Open preview modal and update content\n            if (this.previewModal) {\n                this.previewModal.open();\n\n                this.updateCartContent(this.previewModal, response.data.cart_item.id);\n            } else {\n                this.$overlay.show();\n                // if no modal, redirect to the cart page\n                this.redirectTo(response.data.cart_item.cart_url || this.context.urls.cart);\n            }\n        });\n    }\n ```\n\n### Usage in Cornerstone\n- [`assets/js/theme/common/product-details.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/common/product-details.js)\n\n### [itemUpdate](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L70)\n\nThe <code>itemUpdate</code> function allows your code to update a specified cart item’s quantity:\n\n`utils.api.cart.itemUpdate(itemId, qty, callback)`\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>itemId</td>\n    <td>String</td>\n    <td>The item’s ID</td>\n  </tr>\n  <tr>\n    <td>qty</td>\n    <td>Integer</td>\n    <td>The item’s quantity in the cart</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody></table>\n\n<b>itemUpdate Example</b>\n\n```js\n\n     cartUpdate($target) {\n        const itemId = $target.data('cartItemid');\n        const $el = $(`#qty-${itemId}`);\n        const oldQty = parseInt($el.val(), 10);\n        const maxQty = parseInt($el.data('quantityMax'), 10);\n        const minQty = parseInt($el.data('quantityMin'), 10);\n        const minError = $el.data('quantityMinError');\n        const maxError = $el.data('quantityMaxError');\n        const newQty = $target.data('action') === 'inc' ? oldQty + 1 : oldQty - 1;\n        // Does not quality for min/max quantity\n        if (newQty < minQty) {\n            return swal({\n                text: minError,\n                type: 'error',\n            });\n        } else if (maxQty > 0 && newQty > maxQty) {\n            return swal({\n                text: maxError,\n                type: 'error',\n            });\n        }\n\n        this.$overlay.show();\n\n        utils.api.cart.itemUpdate(itemId, newQty, (err, response) => {\n            this.$overlay.hide();\n\n            if (response.data.status === 'succeed') {\n                // if the quantity is changed \"1\" from \"0\", we have to remove the row.\n                const remove = (newQty === 0);\n\n                this.refreshContent(remove);\n            } else {\n                $el.val(oldQty);\n                swal({\n                    text: response.data.errors.join('\\n'),\n                    type: 'error',\n                });\n            }\n        });\n    }\n ```\n\n### Usage in Cornerstone\n- [`assets/js/theme/cart.js`](https://github.com/bigcommerce/cornerstone/blob/d786c6ecbed5ad588ed9489f79e2226455a07b21/assets/js/theme/cart.js)\n\n### [itemRemove](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L106)\n\nThe <code>itemRemove</code> function allows your code to remove items from the cart:\n\n`utils.api.cart.itemRemove(itemId, callback)`\n\n<table>\n  <tbody>\n\t<tr>\n    <th>Argument</td>\n    <th>Type</td>\n    <th>Description/Usage</td>\n  </tr>\n  <tr>\n    <td>itemId</td>\n    <td>String</td>\n    <td>The item’s ID</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n\t</tbody>\n</table>\n\n<b>itemRemove Example</b>\n\nIn the following example (from <code>cart.js</code>), <code>itemRemove</code> is called before the if/else test:\n\n```js\n\t\tcartRemoveItem(itemId) {\n        this.$overlay.show();\n        utils.api.cart.itemRemove(itemId, (err, response) => {\n            if (response.data.status === 'succeed') {\n                this.refreshContent(true);\n            } else {\n                alert(response.data.errors.join('\\n'));\n            }\n        });\n    } \n```\n\n### Usage in Cornerstone\n\n- [`assets/js/theme/cart.js`](https://github.com/bigcommerce/cornerstone/blob/d786c6ecbed5ad588ed9489f79e2226455a07b21/assets/js/theme/cart.js)\n\n### [update](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L160)\n\nThe <code>update</code> function allows your code to update the set of items in the cart:\n\n`utils.api.cart.update(itemId, qty, callback)`\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>items</td>\n    <td>Array</td>\n    <td>The items in the cart</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n</table>\n\n**update Example**\n\nThe following example shows a call to `update` within the `itemUpdate` function:\n\n```js\n\n    itemUpdate(itemId, qty, callback) {\n        let callbackArg = callback;\n        let items;\n\n        if (Array.isArray(itemId) && typeof qty === 'function') {\n            callbackArg = qty;\n            items = itemId;\n        } else {\n            items = [\n                {\n                    id: itemId,\n                    quantity: qty,\n                },\n            ];\n        }\n\n        this.update(items, (err, response) => {\n            const emitData = {\n                items,\n                err,\n                response,\n            };\n\n            Hooks.emit('cart-item-update-remote', emitData);\n            callbackArg(err, response);\n        });\n    } \n```\n\n### [getItemGiftWrappingOptions](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L132)\n\nThe `getItemGiftWrappingOptions` function allows your code to retrieve gift-wrapping options for the current cart item, in customized ways:\n\n`utils.api.cart.getItemGiftWrappingOptions(itemId, callback)`\n\n<table>\n  <tbody>\n\t\t<tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>itemId</td>\n    <td>String</td>\n    <td>The cart item</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n\t</tbody>\n</table>\n\n**getItemGiftWrappingOptions Example**\n\nThe following example (from `cart.js`) calls `getItemGiftWrappingOptions` to display gift-wrapping options in a modal:\n\n```js\n    bindGiftWrappingEvents() {\n        const modal = defaultModal();\n\n        $('[data-item-giftwrap]').on('click', event => {\n            const itemId = $(event.currentTarget).data('itemGiftwrap');\n            const options = {\n                template: 'cart/modals/gift-wrapping-form',\n            };\n\n            event.preventDefault();\n\n            modal.open();\n\n            utils.api.cart.getItemGiftWrappingOptions(itemId, options, (err, response) => {\n                modal.updateContent(response.content);\n\n                this.bindGiftWrappingForm();\n            });\n        });\n    }\n  ```\n\n### Usage in Cornerstone\n\n- [`assets/js/theme/cart.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart.js)\n\n### [submitItemGiftWrappingOption](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L150)\n\nThe `submitItemGiftWrappingOption` function allows your code to handle the customer’s gift-wrapping selection for the current cart item:\n\n`utils.api.cart.submitItemGiftWrappingOption(itemId, qty, callback)`\n\n<table>\n  <tbody>\n\t\t<tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>itemId</td>\n    <td>String</td>\n    <td>The cart item</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n</table>\n\n**submitItemGiftWrappingOption Example**\n\nThis commented example shows a simple call to `submitItemGiftWrappingOption`:\n\n```js\n\n    /**\n     * Submit giftwrapping options\n     *\n     * @param {String} itemId\n     * @param {Function} callback\n     */\n    submitItemGiftWrappingOption(itemId, params, callback) {\n        this.remoteRequest(`/gift-wrapping/${itemId}`, 'POST', { params }, callback);\n    }\n ```\n\n### [getContent](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L174)\n\nThe `getContent` function allows your code to display the cart contents in customized ways:\n\n`utils.api.cart.getContent(options, callback)`\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>options</td>\n    <td>Object</td>\n    <td>Template containing content and totals children</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n</table>\n\n**getContent Examples**\n\nThis example (from <code>cart.js</code>) shows a call to <code>getContent</code> within the <code>refreshContent</code> function:\n\n```js\nrefreshContent(remove) {\n        const $cartItemsRows = $('[data-item-row]', this.$cartContent);\n        const $cartPageTitle = $('[data-cart-page-title]');\n        const options = {\n            template: {\n                content: 'cart/content',\n                totals: 'cart/totals',\n                pageTitle: 'cart/page-title',\n                statusMessages: 'cart/status-messages',\n            },\n        };\n\n        this.$overlay.show();\n\n        // Remove last item from cart? Reload\n        if (remove && $cartItemsRows.length === 1) {\n            return window.location.reload();\n        }\n\n        utils.api.cart.getContent(options, (err, response) => {\n            this.$cartContent.html(response.content);\n            this.$cartTotals.html(response.totals);\n            this.$cartMessages.html(response.statusMessages);\n\n            $cartPageTitle.replaceWith(response.pageTitle);\n            this.bindEvents();\n            this.$overlay.hide();\n\n            const quantity = $('[data-cart-quantity]', this.$cartContent).data('cart-quantity') || 0;\n\n            $('body').trigger('cart-quantity-update', quantity);\n        });\n    } \n```\n\n### Usage in Cornerstone\n\n- [`assets/js/theme/global/cart-preview.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/global/cart-preview.js)\n- [`assets/js/theme/cart.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart.js)\n- [`assets/js/theme/common/product-details.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/common/product-details.js)\n\n### [getShippingQuotes](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L193)\n\nThe `getShippingQuotes` function allows your code to retrieve shipping-cost quotes for the cart’s contents. It returns `shippingQuote` objects that contain IDs. You must follow `getShippingQuotes` by calling `submitShippingQuote` on a `quoteId`:\n\n`utils.api.cart.getShippingQuotes(params, renderWith, callback)`\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>params</td>\n    <td>Object</td>\n    <td>Contains country_id, state_id, and zip_code</td>\n  </tr>\n  <tr>\n    <td>template</td>\n    <td>String/Array/Object</td>\n    <td>The template to use for rendering</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n</table>\n\nSee submitShippingQutoes for an example. \n\n### Usage in Cornerstone\n- [`assets/js/theme/cart/shipping-estimator.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart/shipping-estimator.js)\n\n### [submitShippingQuote](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L218)\n\nThe `submitShippingQuote` function must be called after `getShippingQuote`, which returns `shippingQuote` objects that contain IDs. The cart page renders the shipping quotes. When the user selects one of the quotes, this function sends that `quoteId` to the backend:\n\n`utils.api.cart.submitShippingQuote(quoteId, callback)`\n\n<table>\n  <tbody>\n\t\t<tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>quoteId</td>\n    <td>Number</td>\n    <td>ID for a shipping quote returned by <code>getShippingQuotes</code></td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n\t</table>\n\n**getShippingQuotes and submitShippingQuote Example**\n\nThe following example from `cart/shipping-estimator.js` shows calls to both `getShippingQuotes` and `submitShippingQuote`:\n\n```js\nbindEstimatorEvents() {\n        const $estimatorContainer = $('.shipping-estimator');\n        const $estimatorForm = $('.estimator-form');\n\n        $estimatorForm.on('submit', (event) => {\n            const params = {\n                country_id: $('[name=\"shipping-country\"]', $estimatorForm).val(),\n                state_id: $('[name=\"shipping-state\"]', $estimatorForm).val(),\n                city: $('[name=\"shipping-city\"]', $estimatorForm).val(),\n                zip_code: $('[name=\"shipping-zip\"]', $estimatorForm).val(),\n            };\n\n            event.preventDefault();\n\n            utils.api.cart.getShippingQuotes(params, 'cart/shipping-quotes', (err, response) => {\n                $('.shipping-quotes').html(response.content);\n\n                // bind the select button\n                $('.select-shipping-quote').on('click', (clickEvent) => {\n                    const quoteId = $('.shipping-quote:checked').val();\n\n                    clickEvent.preventDefault();\n\n                    utils.api.cart.submitShippingQuote(quoteId, () => {\n                        location.reload();\n                    });\n                });\n            });\n        }); \n```\n\n### Usage in Cornerstone\n- [`assets/js/theme/cart/shipping-estimator.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart/shipping-estimator.js)\n\n### [applyCode](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L234)\n\nThe `applyCode` function applies a coupon code or gift certificate to the cart:\n\n`utils.api.cart.applyCode(code, callback)`\n\n<table>\n  <tbody>\n\t\t<tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>code</td>\n    <td>String</td>\n    <td>Alphanumeric representation of the coupon or gift-certificate code</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n</table>\n\nIn the following example from `cart.js`,  `applyCode` is called before the final if/else test to apply a coupon code:\n\n```js\nbindPromoCodeEvents() {\n        const $couponContainer = $('.coupon-code');\n        const $couponForm = $('.coupon-form');\n        const $codeInput = $('[name=\"couponcode\"]', $couponForm);\n\n        $('.coupon-code-add').on('click', (event) => {\n            event.preventDefault();\n\n            $(event.currentTarget).hide();\n            $couponContainer.show();\n            $('.coupon-code-cancel').show();\n            $codeInput.focus();\n        });\n\n        $('.coupon-code-cancel').on('click', (event) => {\n            event.preventDefault();\n\n            $couponContainer.hide();\n            $('.coupon-code-cancel').hide();\n            $('.coupon-code-add').show();\n        });\n\n        $couponForm.on('submit', (event) => {\n            const code = $codeInput.val();\n\n            event.preventDefault();\n\n            // Empty code\n            if (!code) {\n                return alert($codeInput.data('error'));\n            }\n\n            utils.api.cart.applyCode(code, (err, response) => {\n                if (response.data.status === 'success') {\n                    this.refreshContent();\n                } else {\n                    alert(response.data.errors.join('\\n'));\n                }\n            });\n        });\n    }\n```\n\n### Usage in Cornerstone\n\n- [`assets/js/theme/cart.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart.js)\n\n### [applyGiftCertificate](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/cart.js#L250)\n\nApply a gift certificate to a cart.\n\n`utils.api.cart.applyGiftCertificate(code, callback)`\n\n| Argument | Type | Description |\n| -- | -- | -- |\n| code | string | Gift certificate code to apply |\n| callback | Function | Asynchronous function call to handle the results |\n\n**applyGiftCertificate Example**\n\n```js\n            utils.api.cart.applyGiftCertificate(code, (err, resp) => {\n                if (resp.data.status === 'success') {\n                    this.refreshContent();\n                } else {\n                    swal({\n                        text: resp.data.errors.join('\\n'),\n                        type: 'error',\n                    });\n                }\n            });\n        });\n    }\n```\n\n### Usage in Cornerstone\n- [`assets/js/theme/cart.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart.js)\n\n## Countries Resource\n\nThese functions allow your theme or app to retrieve standardized country names, by numeric ID or by string.\n\n### [getById](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/countries.js#L23)\n\nThe `getById` function retrieves standardized country names by numeric ID:\n\n`utils.api.countries.getById(countryId, callback)`\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>countryId</td>\n    <td>Number</td>\n    <td>Country code</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n\t</tbody>\n</table>\n\nThe following example a call to `getById`, followed by a call to the `getByName` function (described below):\n\n```js\n/*   \n\t*Get country data by id wrapper\n     * @param {Number} id\n     * @param {Function} callback\n*/\n\n    getById(id, callback) {\n        const url = this.endpoint + id;\n\n        this.remoteRequest(url, 'GET', {}, callback);\n    }\n\n/*\n     * Get country data by country name\n     * @param name\n     * @param callback\n*/\n    getByName(name, callback) {\n        const url = this.endpoint + name;\n\n        this.remoteRequest(url, 'GET', {}, callback);\n    }\n}\n```\n\n### [getByName](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/countries.js#L34)\n\nThe `getByName` function retrieves states by country name, and returns an array of states that can be used in the callback:\n\n`utils.api.countries.getByName(countryName, callback)`\n\n<table>\n  <tbody>\n\t\t<tr>\n    <td>Argument</td>\n    <td>Type</td>\n    <td>Description/Usage</td>\n  </tr>\n  <tr>\n    <td>countryName</td>\n    <td>String</td>\n    <td>Country name</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n\t</tbody>\n</table>\n\nIn the following example from `common/state-country.js`, `getByName` is called after the initial if test:\n\n```js\n$('select[data-field-type=\"Country\"]').on('change', (event) => {\n        const countryName = $(event.currentTarget).val();\n\n        if (countryName === '') {\n            return;\n        }\n\n        utils.api.country.getByName(countryName, (err, response) => {\n            if (err) {\n                alert(context.state_error);\n\n                return callback(err);\n            }\n\n            const $currentInput = $('[data-field-type=\"State\"]');\n\n            if (!_.isEmpty(response.data.states)) {\n                // The element may have been replaced with a select, reselect it\n                const $selectElement = makeStateRequired($currentInput, context);\n\n                addOptions(response.data, $selectElement, options);\n                callback(null, $selectElement);\n            } else {\n                const newElement = makeStateOptional($currentInput, context);\n\n                callback(null, newElement);\n            }\n        });\n    }); \n```\n\n### Usage in Cornerstone\n- [`assets/js/theme/common/state-country.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/common/state-country.js)\n\n## Product Attributes Resource\n\n### [optionChange](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/product-attributes.js#L24) \n\nThe `optionChange` function is fired when the customer selects a product option for the current cart item (for example, changing a shirt’s color from a default \"yellow\" to \"green\").\n\n`utils.api.productAttributes.optionChange(productId, params, callback)`\n\n<table>\n  <tbody>\n\t\t<tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>params</td>\n    <td>Object</td>\n    <td>Contains a collection of IDs that map to product properties (color, size, etc.)</td>\n  </tr>\n  <tr>\n    <td>productId</td>\n    <td>Number</td>\n    <td>ID for this product</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n\t</tbody>\n</table>\n\n**optionChange Examples**\n\nIn this example (from `common/product-details.js`), `optionChange` is called to update options in a Quick View modal:\n\n```js\n// Update product attributes. If we're in quick view and the product has options, then also update the initial view in case items are oos\n        if (_.isEmpty(productAttributesData) && hasOptions) {\n            const $productId = $('[name=\"product_id\"]', $form).val();\n\n            utils.api.productAttributes.optionChange($productId, $form.serialize(), (err, response) => {\n                const attributesData = response.data || {};\n\n                this.updateProductAttributes(attributesData);\n                this.updateView(attributesData);\n            });\n        } else {\n            this.updateProductAttributes(productAttributesData);\n        } \n```\n\n### Usage in Cornerstone\n- [`assets/js/theme/common/product-details.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/common/product-details.js)\n- [`assets/js/theme/cart.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart.js)\n\n### [configureInCart](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/product-attributes.js#L50)\n\nConfigure product options in the cart. \n\n`utils.api.productAttributes.configureInCart(itemId, options, callback)`\n\n| Argument | Type | Description|\n|-|-| -- |\n| itemId | number | product ID|\n| params | object | |\n| callback | Function | Asynchronous function call to handle the results |\n\n**configureCart Example**\n\n```js\n\n   utils.api.productAttributes.configureInCart(itemId, options, (err, response) => {\n       modal.updateContent(response.content);\n       this.bindGiftWrappingForm();\n ```\n\n### Usage in Cornerstone\n\n- [`assets/js/theme/cart.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/cart.js)\n\n## Product Resource\n\nThe `product.getById` function allows your code to retrieve, and to present, detailed product information by product ID.\n\n### [getById](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/product.js)\n\n`utils.api.product.getById(productId, params, callback)`\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>productId</td>\n    <td>Number</td>\n    <td>ID for this product</td>\n  </tr>\n  <tr>\n    <td>params</td>\n    <td>Object</td>\n    <td>Contains request options and/or presentation template</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n\t</tbody>\n</table>\n\n**product.getById Example**\n\n```js\n\t$('body').on('click', '.quickview', (event) => {\n        event.preventDefault();\n\n        const productId = $(event.currentTarget).data('product-id');\n\n        modal.open({ size: 'large' });\n\n        utils.api.product.getById(productId, { template: 'products/quick-view' }, (err, response) => {\n            modal.updateContent(response);\n\n            modal.$content.find('.productView').addClass('productView--quickView');\n\n            return new ProductDetails(modal.$content.find('.quickView'), context);\n        });\n    }); \n  ```\n\n### Usage in Cornerstone\n- [`assets/js/theme/global/quick-view.js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/global/quick-view.js)\n\n## Search Resource\n\nThe `search` function allows you to present a customized user interface for search results.\n\n### [search](https://github.com/bigcommerce/stencil-utils/blob/master/src/api/search.js)\n\n`utils.api.search.search(query, params, callback)`\n\n<table>\n  <tbody><tr>\n    <th>Argument</th>\n    <th>Type</th>\n    <th>Description/Usage</th>\n  </tr>\n  <tr>\n    <td>query</td>\n    <td>String</td>\n    <td>Contains the customer’s search query</td>\n  </tr>\n  <tr>\n    <td>params</td>\n    <td>Object</td>\n    <td>Contains request options and/or presentation template</td>\n  </tr>\n  <tr>\n    <td>callback</td>\n    <td>Function</td>\n    <td>Asynchronous function call to handle the results</td>\n  </tr>\n</tbody>\n</table>\n\n**search Example**\n\n```js\n\n    const doSearch = _.debounce((searchQuery) => {\n        utils.api.search.search(searchQuery, { template: 'search/quick-results' }, (err, response) => {\n            if (err) {\n                return false;\n            }\n\n            $quickSearchResults.html(response);\n        });\n    }, 200);\n```\n\n### Usage in Cornerstone\n- [`assets/js/theme/global/quick-search/js`](https://github.com/bigcommerce/cornerstone/blob/master/assets/js/theme/global/quick-search.js)\n\n## Config Object\n\nA `config` object can be passed in as part of the Stencil Utils API.\nThe object only returns data **in the context** of that call. The config will not be available to anything else. It will not surface objects that are not normally available to the page. Use YAML to return objects in the context of an entire page. Some config objects can only be used on the listed pages, while others are available globally. \n\n```js\ngetCartContent(cartItemHash, onComplete) {\n        const options = {\n            template: 'cart/preview',\n            params: {\n                suggest: cartItemHash,\n            },\n            config: {\n                cart: {\n                    suggestions: {\n                        limit: 4,\n                    },\n                },\n            },\n        };\n```\n\n### Search Attributes\n\n[Product Search Results](https://github.com/bigcommerce/cornerstone/blob/master/templates/pages/search.html)\n\n```js\n        {\n           \"search\": {\n              \"product_results\": {\n                 \"limit\": 5\n              }\n           }\n        }\n```\n\n### Brands\n\n[Brand List Page](https://github.com/bigcommerce/cornerstone/blob/master/templates/pages/brands.html)\n\n```js\n        {\n           \"brands\": {\n              \"limit\": 5\n           }\n        }\n```\n\n[Brand Page](https://github.com/bigcommerce/cornerstone/blob/master/templates/pages/brand.html)\n\n```js\n        {\n           \"brand\": {\n              \"products\": {\n                 \"limit\": 5\n              }\n           }\n        }\n```\n\n### Cart\n\n[Cart Page](https://github.com/bigcommerce/cornerstone/blob/master/templates/pages/cart.html)\n\n```js\n        {\n           \"cart\": {\n              \"suggestions\": {\n                 \"limit\": 5\n              }\n           }\n        }\n```\n\n### Product\n\n[Product Page](https://github.com/bigcommerce/cornerstone/blob/master/templates/pages/product.html)\n\n```js\n        {\n           \"product\": {\n              \"videos\": {\n                 \"limit\": 11\n              },\n              \"images\": {\n                 \"limit\": 12\n              },\n              \"reviews\": {\n                 \"limit\": 13\n              },\n              \"related_products\": {\n                 \"limit\": 14\n              },\n              \"similar_by_views\": {\n                 \"limit\": 15\n              }\n           }\n        }\n```\n \n\n### Blog\n\n[Blog Page](https://github.com/bigcommerce/cornerstone/blob/master/templates/pages/blog.html)\n\n```js\n        {\n           \"blog\": {\n              \"posts\": {\n                 \"limit\": 5,\n                 \"pages\": 3,\n                 \"summary\": 10\n              }\n           }\n        }\n```\n\n \n\n### Category\n\n[Category Page](https://github.com/bigcommerce/cornerstone/blob/master/templates/pages/category.html)\n\n```js\n        {\n           \"category\": {\n             \"shop_by_price\": false,\n             \"products\": {\n               \"limit\": 5\n             }\n           }\n        }\n```\n\n### Global Objects\n\n**Products**\n\n```js\n        {\n           \"products\": {\n             \"featured\": 3,\n             \"new\": 4,\n             \"top_sellers\": 10\n           }\n        }\n```\n\n```js\n        {\n           \"products\": {\n             \"featured\": {\n               \"limit\": \"5\"\n             },\n             \"new\": {\n               \"limit\": \"10\"\n             },\n             \"top_sellers\": {\n               \"limit\": \"15\"\n             }\n           }\n        }\n\n```\n\n**All Objects**\n\n```js\n         {\n           \"customer\": {\n             \"addresses\": false,\n             \"returns\": true,\n             \"wishlists\": {\n               \"limit\": 3\n             },\n             \"orders\": {\n               \"limit\": 4\n             },\n             \"recently_viewed_products\": true\n           },\n           \"products\": {\n             \"featured\": {\n               \"limit\": 3\n             },\n             \"new\": {\n               \"limit\": 4\n             },\n             \"top_sellers\": {\n               \"limit\": 5\n             }\n           },\n           \"carousel\": true,\n           \"blog\": {\n             \"recent_posts\": {\n               \"limit\": 7\n             },\n             \"summary\": 6\n           },\n           \"cart\": true,\n           \"shipping_messages\": true,\n           \"categories\": {\n             \"description\": true\n           },\n           \"shop_by_brand\": {\n             \"limit\": 4\n           }\n        }\n```\n\n## Resources\n* [Stencil Utils](https://github.com/bigcommerce/stencil-utils) (BigCommerce GitHub)\n"}],"children":[]}}}}
